@model IEnumerable<TaskManagement.Models.MstrProject>

@{
    ViewBag.Title = "Project List";
}

<br />
<button id="addProjectBtn" class="btn btn-success btn-sm">Add Project</button>
<br />

<table id="jqGrid"></table>
<div id="jqGridPager"></div>

<link href="~/css/theme/jquery-ui.min.css" rel="stylesheet" />
<link href="~/css/ui.jqgrid.css" rel="stylesheet" />

@section scripts {
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://code.jquery.com/jquery-migrate-1.4.1.min.js"></script>
    <script src="~/js/jqgrid/grid.locale-en.js"></script>
    <script src="~/js/jqgrid/jquery.jqgrid.min.js"></script>
    <script src="~/js/jqgrid/jquery-ui.min.js"></script>
    <script>
        $(function () {
            // Prepare data for jqGrid
            const gridData = @Html.Raw(Json.Serialize(ViewBag.Projects));

            // Initialize jqGrid
            $("#jqGrid").jqGrid({
                datatype: "local", // Use local data
                data: gridData, // Bind gridData to the jqGrid

                colModel: [
                    { label: "ProjectId", name: "projectId", key: true, hidden: true },
                    { label: "ProjectTitle", name: "projectTitle", width: 150 },
                    { label: "Customer", name: "customerName", width: 150 },
                    { label: "Manager", name: "name", width: 150 },
                    { label: "LastModifiedBy", name: "lastmodifiedby", width: 150 },
                    { label: "Type", name: "type", width: 100 },
                    { label: "LastModifiedOn", name: "lastModifiedOn", width: 120, formatter: "date" },
                    { label: "Start Date", name: "startDate", width: 120, formatter: "date" },
                    { label: "End Date", name: "endDate", width: 120, formatter: "date" },
                    { label: "Status", name: "status", width: 100 },
                    {
                        label: "Actions",
                        name: "actions",
                        width: 300,
                        sortable: false,
                        formatter: function (cellvalue, options, rowObject) {
                            return `
                                <button class="btn btn-primary btn-sm editBtn" data-id="${rowObject.projectId}">Edit</button><br>
                                <button class="btn btn-primary btn-sm detailsBtn" data-id="${rowObject.projectId}">Detail</button><br>
                                <button class="btn btn-danger btn-sm deleteBtn" data-id="${rowObject.projectId}">Deactivate</button>
                            `;
                        },
                        align: 'center'
                    }
                ],
                pager: "#jqGridPager",
                rowNum: 10,
                rowList: [10, 20, 30],
                sortname: "projectName",
                sortorder: "asc",
                viewrecords: true,
                height: 'auto',
                jsonReader: {
                    repeatitems: false,
                    id: "projectId"
                }
            });

            // Add button click event
            $('#addProjectBtn').on('click', function () {
                window.location.href = '/Project/Create';
            });

            // Handle Edit and Delete buttons
            $(document).on('click', '.editBtn', function () {
                const projectId = $(this).data('id');
                window.location.href = `/Project/Edit/${projectId}`;
            });
            $(document).on('click', '.detailsBtn', function () {
                const projectId = $(this).data('id');
                window.location.href = `/Project/Details/${projectId}`;
            });
            $(document).on('click', '.deleteBtn', function () {
                const projectId = $(this).data('id');
                if (confirm("Are you sure you want to deactivate this project?")) {
                    window.location.href = `/Project/Delete/${projectId}`;
                }
            });

            // Enable jqGrid navigation
            $("#jqGrid").jqGrid('navGrid', '#jqGridPager',
                { edit: false, add: false, del: false, search: true, refresh: true });
        });
    </script>
}